@page "/bookings"
@using Microsoft.EntityFrameworkCore
@using BellaFrisoer.Domain.Models
@inject IDbContextFactory<BellaFrisoer.WebUi.Data.BellaFrisoerWebUiContext> DbFactory

<PageTitle>Bookings</PageTitle>

<h1>Bookings</h1>

<p>
    <a class="btn btn-primary" href="/bookings/create">Create Booking</a>
    <a class="btn btn-secondary" href="/customers">Customers</a>
</p>

<<<<<<< HEAD
<QuickGrid Class="table" Items="context.Bookings">
    <PropertyColumn Property="booking => booking.BookingDateTime" />
    <PropertyColumn Property="booking => booking.Customer" />

    <TemplateColumn Context="booking">
        <a href="@($"bookings/edit?id={booking.Id}")">Edit</a> |
        <a href="@($"bookings/details?id={booking.Id}")">Details</a> |
        <a href="@($"bookings/delete?id={booking.Id}")">Delete</a>
    </TemplateColumn>
</QuickGrid>
=======
@if (bookings is null)
{
    <p><em>Loading...</em></p>
}
else if (!bookings.Any())
{
    <p>No bookings yet.</p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Customer</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var b in bookings)
            {
                <tr>
                    <td>@b.BookingDateTime</td>
                    <td>@(b.Customer?.Name ?? "—")</td>
                    <td>
                        <a href="@($"/bookings/details?id={b.Id}")">Details</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
>>>>>>> Oskar

@code {
    private List<Booking>? bookings;

    protected override async Task OnInitializedAsync()
    {
        using var ctx = DbFactory.CreateDbContext();
        bookings = await ctx.Bookings
            .Include(b => b.Customer)
            .OrderBy(b => b.BookingDateTime)
            .ToListAsync();
    }
}
