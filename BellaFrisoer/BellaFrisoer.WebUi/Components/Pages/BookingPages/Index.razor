@page "/bookings"
@using Microsoft.EntityFrameworkCore
@using BellaFrisoer.Domain.Models
@inject IDbContextFactory<BellaFrisoer.WebUi.Data.BellaFrisoerWebUiContext> DbFactory

<PageTitle>Bookings</PageTitle>

<h1>Bookings</h1>

<p>
    <a class="btn btn-primary" href="/bookings/create">Create Booking</a>
    <a class="btn btn-secondary" href="/customers">Customers</a>
</p>

@if (bookings is null)
{
    <p><em>Loading...</em></p>
}
else if (!bookings.Any())
{
    <p>Ingen bookings endnu...</p>
}
else
{
	<table class="table table-striped table-hover">
		<thead>
		<tr>
			<th>Ansatte</th>
			<th>Kunde</th>
			<th>Dato/Tidspunkt</th>
			<th></th>
		</tr>
		</thead>
		<tbody>
		@foreach (var b in bookings)
		{
			<tr>
				<td>@(b.Employee?.Name ?? "—")</td>
				<td>@(b.Customer?.Name ?? "-")</td>
					<td>@(b.BookingDateTime.ToString() ?? "—")</td>

					<td>
					<a href="/bookings/details?id=@b.Id" class="btn btn-sm btn-primary">Details</a>
				</td>
			</tr>
		}
		</tbody>
	</table>
}

@code {
    private List<Booking>? bookings;

    protected override async Task OnInitializedAsync()
    {
        using var ctx = DbFactory.CreateDbContext();
        bookings = await ctx.Bookings
            .Include(b => b.Customer)
            .Include(b => b.Employee)
            .OrderBy(b => b.BookingDateTime)
            .ToListAsync();
    }
}
