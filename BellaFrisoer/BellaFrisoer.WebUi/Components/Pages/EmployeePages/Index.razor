@page "/ansatte"
@using BellaFrisoer.Application.Interfaces
@using BellaFrisoer.Domain.Models
@inject IEmployeeService EmployeeService

<PageTitle>Ansatte</PageTitle>

<h1>Ansatte</h1>

<p>
	<a class="btn btn-primary" href="/ansatte/opret">Opret Ansat</a>
	<a class="btn btn-secondary" href="/bookings">Bookings</a>
</p>
<input @oninput="OnSearchChanged" class="form-control mb-3" placeholder="Søg Ansatte..." />

@if (employees is null)
{
	<p><em>Indlæser...</em></p>
}
else if (!employees.Any())
{
	<p>Ingen ansatte endnu...</p>
}
else
{

	<table class="table table-striped table-hover">
		<thead>
		<tr>
			<th>Id</th>
			<th>Navn</th>
			<th>Timepris</th>
			<th>Telefon</th>
			<th>Email</th>
			<th>Kompetencer</th>
			<th></th>
		</tr>
		</thead>

		<tbody>
		@foreach (var e in employees)
		{
			<tr>
				<td>@e.Id</td>
				<td>@($"{e.FirstName} {e.LastName}")</td>
				<td>@e.HourlyPrice</td>
				<td>@e.PhoneNumber</td>
				<td>@e.Email</td>
				<td>@e.Qualifications</td>

				<td>
					<a href="/ansatte/detaljer?id=@e.Id" class="btn btn-sm btn-primary">Detaljer</a>
					<a href="/ansatte/rediger?id=@e.Id" class="btn btn-sm btn-warning">Rediger</a>
					<a href="/ansatte/slet?id=@e.Id" class="btn btn-sm btn-danger">Slet</a>
				</td>
			</tr>
		}
		</tbody>
	</table>
}

@code {
	private List<Employee>? employees;

	protected override async Task OnInitializedAsync()
	{
		employees = await EmployeeService.GetAllAsync();
	}
	private async Task OnSearchChanged(ChangeEventArgs e)
	{
		string searchString = e.Value?.ToString() ?? string.Empty;
		employees = await EmployeeService.FilterEmployeesAsync(searchString);
	}
}