@page "/"
@using BellaFrisoer.Infrastructure.Data
@using Microsoft.EntityFrameworkCore
@inject IDbContextFactory<BellaFrisoer.Infrastructure.Data.BellaFrisoerWebUiContext> DbFactory

@rendermode InteractiveServer

<PageTitle>Kalender</PageTitle>

<!--
	<EditForm Model="@this">
		Fortæller blazor at dette er en formular der kan modtage data.
-->
<EditForm Model="@this">
	<InputDate @bind-Value="myDate" />
</EditForm>


<button @onclick="SortBookings">Sort Bookings</button>
<p>@myDate.ToShortDateString()</p>

@if (SortedBookings.Any())
{
	@foreach (Booking b in SortedBookings)
	{
		<p>@b.Customer</p>
		<p> Har en tid kl. @b.BookingDateTime.TimeOfDay</p>
	}
}


@code {
	private DateTime myDate = DateTime.Today;
	private List<Booking> SortedBookings { get; set; } = new List<Booking>();

	private async Task SortBookings()
	{
		using var context = DbFactory.CreateDbContext();
		SortedBookings = await context.Bookings
			.Include(b => b.Customer)
			.Where(b => b.BookingDateTime.Date == myDate.Date)
			.ToListAsync();
	}

}